<div *ngIf="isSpinner" class="loader">
  <mat-spinner
    style="
      position: absolute;
      left: 0px;
      right: 0px;
      top: 0px;
      bottom: 0px;
      margin: auto;
    "
  ></mat-spinner>
</div>
<div class="ConfigurationTypes_downloadCsv w-100">
  <div class="container">
    <div class="row">
      <div
        [ngClass]="{ 'col-md-6': responseValue, 'col-md-12': !responseValue }"
      >
        <form [formGroup]="tableUploadForm" (ngSubmit)="ontableUploadSubmit()">
          <!-- <div class="form-group inrne-addon">
            <mat-form-field>
              <input
                matInput
                type="text"
                autocomplete="off"
                name="tableId"
                id="tableId"
                placeholder=" Table Name"
                [formControl]="tableUploadForm.controls['tableId']"
              />
              <span matPrefix> </span>
              <mat-error *ngFor="let validation of validation_messages.tableId">
                <span
                  *ngIf="
                    tableUploadForm.get('tableId').hasError(validation.type)
                  "
                >
                  {{ validation.message }}
                </span>
              </mat-error>
            </mat-form-field>
          </div> -->
          <!-- <mat-form-field appearance="fill">
                  <mat-label>Select Table</mat-label>
                  <mat-select formControlName="tableId" disableOptionCentering>
                    <mat-option
                      *ngFor="let tableDetails of tablesListWithPermissionId"
                      [value]="tableDetails.tableId"
                      (click)="getTableName(tableDetails)"
                      (keydown)="getTableName(tableDetails)"
                    >
                      {{ tableDetails.tableName }}</mat-option
                    >
                  </mat-select>
                  <mat-error
                    *ngIf="
                      tableUploadForm.controls['tableId'].hasError('required') &&
                      tableUploadForm.controls['tableId'].touched
                    "
                  >
                    table name is required
                  </mat-error>
                </mat-form-field> -->
          <div id="upload">
            <h4 class="text-center dropZoneTitle">
              Select data template excel file to upload
            </h4>
            <div class="drag-riles" appDnd (fileDropped)="onFileChange($event)">
              <input
                type="file"
                [formControl]="tableUploadForm.controls['file']"
                #fileDropRef
                id="fileDropRef"
                (click)="$event.target.value = null"
                (change)="onFileChange($event)"
                accept=".xls,.xlsx"
              />
              <img
                src="assets/images/UploadImg.jpeg"
                alt="Upload"
                width="80"
                height="64"
              />
              <h3>Drag and drop file here</h3>
              <h3>or</h3>
              <label
                for="fileDropRef"
                class="btn btn-outline-secondary btn-rounded"
                >Browse for file</label
              >
              <p class="ConfigurationTypes_noteInfo">
                Note: Only .XLSX/.XLS file types allowed.
              </p>
            </div>
            <div class="files-list">
              <div
                class="single-file"
                *ngFor="let file of files; let i = index"
              >
                <div class="file-icon" style="width: 50px">
                  <svg
                    version="1.1"
                    id="Capa_1"
                    xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink"
                    x="0px"
                    y="0px"
                    viewBox="0 0 58 58"
                    style="enable-background: new 0 0 58 58"
                    xml:space="preserve"
                  >
                    <polygon
                      style="fill: #edeada"
                      points="51.5,14 37.5,0 6.5,0 6.5,58 51.5,58 "
                    />
                    <g>
                      <path
                        style="fill: #cec9ae"
                        d="M16.5,23h25c0.552,0,1-0.447,1-1s-0.448-1-1-1h-25c-0.552,0-1,0.447-1,1S15.948,23,16.5,23z"
                      />
                      <path
                        style="fill: #cec9ae"
                        d="M16.5,15h10c0.552,0,1-0.447,1-1s-0.448-1-1-1h-10c-0.552,0-1,0.447-1,1S15.948,15,16.5,15z"
                      />
                      <path
                        style="fill: #cec9ae"
                        d="M41.5,29h-25c-0.552,0-1,0.447-1,1s0.448,1,1,1h25c0.552,0,1-0.447,1-1S42.052,29,41.5,29z"
                      />
                      <path
                        style="fill: #cec9ae"
                        d="M41.5,37h-25c-0.552,0-1,0.447-1,1s0.448,1,1,1h25c0.552,0,1-0.447,1-1S42.052,37,41.5,37z"
                      />
                      <path
                        style="fill: #cec9ae"
                        d="M41.5,45h-25c-0.552,0-1,0.447-1,1s0.448,1,1,1h25c0.552,0,1-0.447,1-1S42.052,45,41.5,45z"
                      />
                    </g>
                    <polygon
                      style="fill: #cec9ae"
                      points="37.5,0 37.5,14 51.5,14 "
                    />
                  </svg>
                </div>
                <div class="info">
                  <h3 class="name">
                    <strong>Selected File: {{ selectedFile?.name }}</strong>
                  </h3>
                  <!-- <p class="size">
                    {{ formatBytes(file?.size) }}
                  </p> -->
                </div>
              </div>
            </div>
            <mat-error
              class="text-left"
              *ngFor="let validation of validation_messages.file"
            >
              <span
                *ngIf="
                  tableUploadForm.get('file')?.hasError(validation.type) &&
                  tableUploadForm.get('file').touched
                "
              >
                {{ validation.message }}
              </span>
            </mat-error>
          </div>
          <div class="mt-3 mb-3">
            <button
              type="submit"
              class="btn btn-outline-secondary btn-rounded d-inline-block m-2"
            >
              Confirm
            </button>
            <button
              type="button"
              (click)="onCancel()"
              class="btn btn-outline-secondary btn-rounded d-inline-block m-2"
            >
              Cancel
            </button>
          </div>
        </form>
      </div>
      <div class="col-md-6" *ngIf="responseValue">
        <div class="text-justify lh-base">
          <div
            class="d-flex flex-row flex-wrap align-items-center justify-content-between"
          >
            <div class="">
              <strong>Status :</strong> {{ responseValue?.status }}
            </div>
            <div class="">
              <strong>Total Column :</strong>
              {{ responseValue?.total_rows }}
            </div>
          </div>
          <br />
          <div
            class="d-flex flex-row flex-wrap align-items-center justify-content-between"
          >
            <div class="">
              <strong>Mapped Column :</strong>
              {{ responseValue?.inserted_rows }}
            </div>
            <div class="">
              <strong>UnMapped Column :</strong>
              {{ responseValue?.total_rows - responseValue?.inserted_rows }}
            </div>
          </div>
          <br />

          <div class="">
            <strong>Processed Columns : </strong><br />
            {{ responseValue?.processed_columns?.join(", ") }}
          </div>
          <br />

          <div class="">
            <strong>Missing Columns :</strong><br />
            {{ responseValue?.missing_columns?.join(", ") }}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
